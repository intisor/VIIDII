@page
@model FutaMeetWeb.Pages.CreateSessionModel
@{
    ViewData["Title"] = "Create Session - FutaMeet";
}

<div class="container mt-4">
    <h2 class="text-center mb-4 modern-heading">Create a Session (FUTA)</h2>

    <!-- Loading Skeleton -->
    <div id="loading-skeleton" style="display: none;">
        <div class="mb-3">
            <div class="placeholder-glow">
                <span class="placeholder col-3 modern-placeholder"></span>
            </div>
            <div class="placeholder-glow mt-2">
                <span class="placeholder col-12 modern-placeholder" style="height: 38px;"></span>
            </div>
        </div>
        <div class="placeholder-glow mt-3">
            <span class="placeholder col-4 modern-placeholder" style="height: 38px;"></span>
        </div>
    </div>

    <!-- Main Content -->
    <div id="main-content">
        <!-- Form to Create Session -->
        <form method="post" onsubmit="showLoadingSkeleton()" class="modern-form p-4 mb-4">
            <div class="mb-3">
                <label asp-for="Title" class="form-label modern-label">Session Title</label>
                <input asp-for="Title" class="form-control modern-input" required />
            </div>
            <button type="submit" class="btn btn-skeuo w-100">
                <i class="fas fa-plus-circle"></i> Create Session
            </button>
        </form>

        <!-- Session UI (after creation) -->
        @if (!string.IsNullOrEmpty(Model.Message) && Model.Message.StartsWith("Created session"))
        {
            <div class="row mt-4">
                <!-- Media (audio/video) -->
                <div class="col-md-8">
                    <video id="localVideo" autoplay muted class="modern-video"></video>
                    <div id="remoteAudios" class="mt-2"></div>
                    <div class="d-flex gap-2 mt-2">
                        <button id="startSession" class="btn btn-skeuo flex-fill" onclick="this.disabled = true; initSession('@Model.CurrentSessionId', '@HttpContext.Session.GetString("MatricNo")', true)">
                            <i class="fas fa-play"></i> Start Session
                        </button>
                        <button id="toggleAudio" class="btn btn-skeuo flex-fill" onclick="toggleAudio()">
                            <i class="fas fa-microphone-slash"></i> Mute
                        </button>
                    </div>
                </div>
                <!-- Chat -->
                <div class="col-md-4">
                    <h4 class="modern-heading">Chat</h4>
                    <div id="chatMessages" class="border rounded p-2"></div>
                    <div class="input-group mt-2">
                        <textarea id="chatInput" rows="2" class="form-control modern-input" placeholder="Type a message..."></textarea>
                        <button class="btn btn-skeuo" onclick="sendMessage()">
                            <i class="fas fa-paper-plane"></i> Send
                        </button>
                    </div>
                </div>
            </div>
        }

        <!-- Status Message -->
        @if (!string.IsNullOrEmpty(Model.Message))
        {
            <p class="mt-3 text-center modern-status">@Model.Message</p>
        }
    </div>
</div>

<link href="~/lib/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="~/css/site.css" rel="stylesheet" />
<script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
@section Scripts {
    <!-- Loading Skeleton -->
    <script>
        function showLoadingSkeleton() {
            document.getElementById("loading-skeleton").style.display = "block";
            document.getElementById("main-content").style.display = "none";
        }
    </script>
    <!-- SignalR and session.js -->
    <script src="~/js/signalr.min.js"></script>
    <script src="~/js/session.js" asp-append-version="true"></script>
}